name: Archive all posts
on:
  schedule:
    - cron: 36 0 * * *
  workflow_dispatch:
jobs:
  archive:
    runs-on: ubuntu-latest
    steps:
      - name: Check out code.
        uses: actions/checkout@v4
      - name: Install zsh
        run: sudo apt-get update; sudo apt-get install zsh
      - name: Retrieve all posts
        run: |
          echo "POSTS=\"$(./all-posts.sh)\"" >> $GITHUB_OUTPUT
        id: posts
        # docker run -it --rm secsi/waybackpy --url "<target_url>" --user_agent "my-unique-user-agent" --oldest
      - uses: JamieMagee/wayback@v2.0.0
        with:
          url: ${{ fromJson(steps.posts.outputs.POSTS) }}
          saveErrors: false
          saveOutlinks: true
          saveScreenshot: true
